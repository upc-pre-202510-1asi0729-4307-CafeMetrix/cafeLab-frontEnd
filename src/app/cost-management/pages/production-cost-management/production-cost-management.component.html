<app-toolbar></app-toolbar>

<div class="main-container">
  <!-- Pantalla de éxito -->
  <div *ngIf="isSuccess" class="success-screen">
    <div class="success-message">
      <h2>Registro guardado exitosamente</h2>
      <p class="registration-code">Código de registro: {{ registrationCode }}</p>
    </div>

    <div class="success-content">
      <app-metrics-card
        [costPerKg]="costPerKg"
        [potentialMargin]="potentialMargin"
        [suggestedPrice]="suggestedPrice">
      </app-metrics-card>

      <app-recommendations-card [recommendations]="recommendations"></app-recommendations-card>
    </div>

    <div class="button-container">
      <button mat-raised-button class="action-button" (click)="onExit()">
        Salir
      </button>
      <button mat-raised-button class="action-button" (click)="onPrint()">
        Imprimir reporte
      </button>
    </div>
  </div>

  <!-- Formulario paso a paso -->
  <div *ngIf="!isSuccess">
    <mat-stepper linear [selectedIndex]="currentStep" (selectionChange)="currentStep = $event.selectedIndex">
      <!-- Paso 1: Selección de lote -->
      <mat-step [stepControl]="firstFormGroup" [completed]="firstFormGroup.valid">
        <ng-template matStepLabel>Selección de lote</ng-template>
        <form [formGroup]="firstFormGroup">
          <app-step-lot-selection [formGroup]="firstFormGroup"></app-step-lot-selection>

          <div class="button-container">
            <button mat-raised-button color="primary" matStepperNext [disabled]="firstFormGroup.invalid">
              Continuar
            </button>
            <button mat-stroked-button color="warn" (click)="onCancel()">
              Cancelar
            </button>
          </div>
        </form>
      </mat-step>

      <!-- Paso 2: Costos directos -->
      <mat-step [stepControl]="directCostsForm" [completed]="directCostsForm.valid">
        <ng-template matStepLabel>Costos directos</ng-template>
        <form [formGroup]="directCostsForm">
          <app-step-direct-costs [formGroup]="directCostsForm"></app-step-direct-costs>

          <div class="button-container">
            <button mat-button matStepperPrevious>Anterior</button>
            <button mat-raised-button color="primary" matStepperNext [disabled]="directCostsForm.invalid">
              Continuar
            </button>
          </div>
        </form>
      </mat-step>

      <!-- Paso 3: Costos indirectos -->
      <mat-step [stepControl]="indirectCostsForm" [completed]="indirectCostsForm.valid">
        <ng-template matStepLabel>Costos indirectos</ng-template>
        <form [formGroup]="indirectCostsForm">
          <app-step-indirect-costs [formGroup]="indirectCostsForm"></app-step-indirect-costs>

          <div class="button-container">
            <button mat-button matStepperPrevious>Anterior</button>
            <button mat-raised-button color="primary" matStepperNext [disabled]="indirectCostsForm.invalid">
              Continuar
            </button>
          </div>
        </form>
      </mat-step>

      <!-- Paso 4: Resumen -->
      <mat-step>
        <ng-template matStepLabel>Resumen</ng-template>
        <div class="summary-container">
          <app-metrics-card
            [costPerKg]="costPerKg"
            [potentialMargin]="potentialMargin"
            [suggestedPrice]="suggestedPrice">
          </app-metrics-card>

          <app-recommendations-card [recommendations]="recommendations"></app-recommendations-card>

          <div class="button-container">
            <button mat-button matStepperPrevious>Anterior</button>
            <button mat-raised-button color="primary" (click)="onSubmit()">
              Finalizar y Guardar
            </button>
            <button mat-stroked-button color="accent" (click)="onSaveAsDraft()">
              Guardar Borrador
            </button>
          </div>
        </div>
      </mat-step>
    </mat-stepper>
  </div>
</div>
