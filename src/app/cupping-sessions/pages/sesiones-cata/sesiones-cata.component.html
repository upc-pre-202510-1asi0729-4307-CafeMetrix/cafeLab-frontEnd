<mat-toolbar color="primary">
  <app-toolbar/>
</mat-toolbar>

<div class="sesiones-container">
  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a routerLink="/welcome-barista"> {{ 'NAVIGATION.HOME' | translate }}</a>
    <mat-icon>chevron_right</mat-icon>
    <ng-container *ngIf="!mostrarComparacion && !mostrarDetalle">
      <span class="active">{{ 'CONSULTATIONS.CUPPING_SESSIONS' | translate }}</span>
    </ng-container>
    <ng-container *ngIf="mostrarComparacion">
      <a (click)="toggleComparacion()" class="breadcrumb-link">Sesiones de Cata</a>
      <mat-icon>chevron_right</mat-icon>
      <span class="active">Comparación de Múltiples Catas</span>
    </ng-container>
    <ng-container *ngIf="mostrarDetalle">
      <a (click)="mostrarDetalle = false; sesionSeleccionada = null" class="breadcrumb-link">Sesiones de Cata</a>
      <mat-icon>chevron_right</mat-icon>
      <span class="active">{{sesionSeleccionada?.nombre}}</span>
    </ng-container>
  </div>

  <!-- Vista principal de sesiones -->
  <div class="main-content" *ngIf="!mostrarComparacion && !mostrarDetalle">
    <!-- Barra de búsqueda y acciones -->
    <div class="actions-bar">
      <div class="search-section">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>{{ 'CUPPING_SESSIONS.SEARCH_SESSIONS' | translate }}</mat-label>
          <input matInput [(ngModel)]="searchText" placeholder="{{ 'CUPPING_SESSIONS.NAME' | translate }}">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <button mat-icon-button (click)="mostrarFiltros()" class="filter-button">
          <mat-icon>filter_list</mat-icon>
        </button>
      </div>

      <button mat-raised-button class="compare-button" (click)="toggleComparacion()">
        {{ 'CUPPING_SESSIONS.COMPARE' | translate }}
      </button>
    </div>

    <!-- Tabla de sesiones -->
    <table mat-table [dataSource]="sesionesFiltradas" class="mat-elevation-z8">
      <!-- Nombre Column -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef>{{ 'CUPPING_SESSIONS.NAME' | translate }}</th>
        <td mat-cell *matCellDef="let sesion">
          <a class="session-link" (click)="verDetalle(sesion)">{{sesion.nombre}}</a>
        </td>
      </ng-container>

      <!-- Fecha Column -->
      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef>{{ 'CUPPING_SESSIONS.DATE' | translate }}</th>
        <td mat-cell *matCellDef="let sesion">{{sesion.fecha}}</td>
      </ng-container>

      <!-- Origen Column -->
      <ng-container matColumnDef="origen">
        <th mat-header-cell *matHeaderCellDef>{{ 'CUPPING_SESSIONS.ORIGIN' | translate }}</th>
        <td mat-cell *matCellDef="let sesion">{{sesion.origen}}</td>
      </ng-container>

      <!-- Variedad Column -->
      <ng-container matColumnDef="variedad">
        <th mat-header-cell *matHeaderCellDef>{{ 'CUPPING_SESSIONS.VARIETY' | translate }}</th>
        <td mat-cell *matCellDef="let sesion">{{sesion.variedad}}</td>
      </ng-container>

      <!-- Acciones Column -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let sesion">
          <button mat-icon-button (click)="toggleFavorito(sesion)">
            <mat-icon [class.favorito]="sesion.favorito">
              {{sesion.favorito ? 'star' : 'star_border'}}
            </mat-icon>
          </button>
          <button mat-icon-button (click)="verDetalle(sesion)">
            <mat-icon>search</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- Botón de nueva cata -->
    <div class="new-cata-button-container">
      <button mat-raised-button (click)="iniciarNuevaCata()" class="new-cata-button">
        {{ 'CUPPING_SESSIONS.RECORD_CUPPING' | translate }}
      </button>
    </div>
  </div>

  <!-- Vista de comparación -->
  <div class="comparison-view" *ngIf="mostrarComparacion">
    <div class="comparison-image-container">
      <img src="assets/multiple-cupping-exmp.png" alt="Comparación de catas" class="comparison-image">
    </div>
  </div>

  <!-- Vista de detalle -->
  <div class="detail-view" *ngIf="mostrarDetalle && sesionSeleccionada">
    <app-detalle-cata [sesion]="sesionSeleccionada"></app-detalle-cata>
  </div>
</div>
